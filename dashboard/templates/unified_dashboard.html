<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Credential Flow – Dashboard</title>

  <!-- Bootstrap 5 – CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Highlight.js per colore del JSON -->
  <link  rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">

  <style>
    body      { padding: 2rem 1.5rem; }
    table     { table-layout: fixed; }
    td, th    { word-wrap: break-word; vertical-align: top; }
    pre       { white-space: pre-wrap; word-break: break-all; }
    .json-box { max-height: 18rem; overflow:auto; }
  </style>
</head>
<body>

<div class="container-lg">

  <h2 class="mb-3">Credential Flow <small class="text-muted fs-6">Issuer &middot; Wallet</small></h2>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:4rem">#</th>
          <th style="width:11rem">When (UTC)</th>
          <th style="width:9rem">From&nbsp;&rarr;&nbsp;To</th>
          <th>Details</th>
          <th style="width:6rem">Source</th>
        </tr>
      </thead>
      <tbody>
      {% for log in logs %}
        <tr>
          <td>{{ log.id }}</td>
          <td>{{ log.created_at }}</td>
          <td>{{ log.actor_from }} → {{ log.actor_to }}</td>
          <td>

            <!-- Accordion (unico per riga) -->
            <div class="accordion accordion-flush" id="row-{{ log.id }}">
              <div class="accordion-item">

                <h2 class="accordion-header" id="h-{{ log.id }}">
                  <button class="accordion-button collapsed py-1 px-2" type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#c-{{ log.id }}">
                    JSON payload
                  </button>
                </h2>

                <div id="c-{{ log.id }}" class="accordion-collapse collapse"
                     data-bs-parent="#row-{{ log.id }}">
                  <div class="accordion-body bg-body-tertiary py-2">

                    <div class="row gy-2">
                      <div class="col-12 col-lg-6">
                        <strong>Request</strong>
                        <pre class="json-box"><code class="language-json">
{{ log.request | default('{}') | tojson(indent=2) }}
                        </code></pre>
                      </div>
                      <div class="col-12 col-lg-6">
                        <strong>Response</strong>
                        <pre class="json-box"><code class="language-json">
{{ log.response | default('{}') | tojson(indent=2) }}
                        </code></pre>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

          </td>
          <td>
              {% if log.source == 'issuer' %}
                <span class="badge bg-primary">issuer</span>
              {% elif log.source == 'wallet' %}
                <span class="badge bg-warning text-dark">wallet</span>
              {% elif log.source == 'verifier' %}
                <span class="badge bg-success">verifier</span>
              {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- JS: Bootstrap + highlight.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
<script>hljs.highlightAll();</script>

</body>
</html>
